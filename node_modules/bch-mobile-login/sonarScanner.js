const scanner = require('sonarqube-scanner');
const pkg = require('./package.json');

const cleanPkgName = (name) => name.replace(/^[^a-zA-Z0-9-_.:]+/, '').replace(/[^a-zA-Z0-9-_.:]+/g, '-');

scanner(
    {
        serverUrl: 'http://200.14.165.72:9000',
        options: {
            'sonar.exclusions': '.vscode/**, android/**, assets/**, build/**, ios/**, node_modules/**, scripts/**',
            'sonar.projectName': cleanPkgName(pkg.name),
            'sonar.projectKey': cleanPkgName(pkg.name),
            'sonar.projectVersion': pkg.version,
            'sonar.projectDescription': pkg.descripcion || 'Revision Sonar Mobile',
            'sonar.eslint.reportPaths': './eslint-report.json',
            'sonar.sources': 'src',
            'sonar.tests': '__tests__',
            'sonar.test.inclusions': '**/*.test.js',
            'sonar.javascript.lcov.reportPaths': 'coverage/lcov.info',
            'sonar.testExecutionReportPaths': 'coverage/test-report.xml',
        },
    },
    () => process.exit(),
);